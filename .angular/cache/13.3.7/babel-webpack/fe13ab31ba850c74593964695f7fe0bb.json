{"ast":null,"code":"import _regeneratorRuntime from \"/Users/raulmelo/Documents/projetos/design-system/storybook-wyz/node_modules/@babel/runtime/regenerator/index.js\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nimport \"core-js/modules/es.object.get-prototype-of.js\";\nimport \"core-js/modules/es.reflect.construct.js\";\nimport \"core-js/modules/es.reflect.get.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.object.freeze.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4;\n\nimport \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport deprecate from 'util-deprecate';\nimport dedent from 'ts-dedent';\nimport global from 'global';\nimport Events, { IGNORED_EXCEPTION } from '@storybook/core-events';\nimport { logger } from '@storybook/client-logger';\nimport { Preview } from './Preview';\nimport { UrlStore } from './UrlStore';\nimport { WebView } from './WebView';\nimport { PREPARE_ABORTED, StoryRender } from './StoryRender';\nimport { DocsRender } from './DocsRender';\nvar globalWindow = global.window;\n\nfunction focusInInput(event) {\n  var target = event.target;\n  return /input|textarea/i.test(target.tagName) || target.getAttribute('contenteditable') !== null;\n}\n\nexport var PreviewWeb = /*#__PURE__*/function (_Preview) {\n  _inherits(PreviewWeb, _Preview);\n\n  var _super = _createSuper(PreviewWeb);\n\n  function PreviewWeb() {\n    var _this;\n\n    _classCallCheck(this, PreviewWeb);\n\n    _this = _super.call(this);\n    _this.urlStore = void 0;\n    _this.view = void 0;\n    _this.previewEntryError = void 0;\n    _this.currentSelection = void 0;\n    _this.currentRender = void 0;\n    _this.view = new WebView();\n    _this.urlStore = new UrlStore(); // Add deprecated APIs for back-compat\n    // @ts-ignore\n\n    _this.storyStore.getSelection = deprecate(function () {\n      return _this.urlStore.selection;\n    }, dedent(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n        `__STORYBOOK_STORY_STORE__.getSelection()` is deprecated and will be removed in 7.0.\\n  \\n        To get the current selection, use the `useStoryContext()` hook from `@storybook/addons`.\\n      \"], [\"\\n        \\\\`__STORYBOOK_STORY_STORE__.getSelection()\\\\` is deprecated and will be removed in 7.0.\\n  \\n        To get the current selection, use the \\\\`useStoryContext()\\\\` hook from \\\\`@storybook/addons\\\\`.\\n      \"]))));\n    return _this;\n  }\n\n  _createClass(PreviewWeb, [{\n    key: \"setupListeners\",\n    value: function setupListeners() {\n      _get(_getPrototypeOf(PreviewWeb.prototype), \"setupListeners\", this).call(this);\n\n      globalWindow.onkeydown = this.onKeydown.bind(this);\n      this.channel.on(Events.SET_CURRENT_STORY, this.onSetCurrentStory.bind(this));\n      this.channel.on(Events.UPDATE_QUERY_PARAMS, this.onUpdateQueryParams.bind(this));\n      this.channel.on(Events.PRELOAD_STORIES, this.onPreloadStories.bind(this));\n    }\n  }, {\n    key: \"initializeWithProjectAnnotations\",\n    value: function initializeWithProjectAnnotations(projectAnnotations) {\n      var _this2 = this;\n\n      return _get(_getPrototypeOf(PreviewWeb.prototype), \"initializeWithProjectAnnotations\", this).call(this, projectAnnotations).then(function () {\n        return _this2.setInitialGlobals();\n      });\n    }\n  }, {\n    key: \"setInitialGlobals\",\n    value: function () {\n      var _setInitialGlobals = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _ref, globals;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _ref = this.urlStore.selectionSpecifier || {}, globals = _ref.globals;\n\n                if (globals) {\n                  this.storyStore.globals.updateFromPersisted(globals);\n                }\n\n                this.emitGlobals();\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setInitialGlobals() {\n        return _setInitialGlobals.apply(this, arguments);\n      }\n\n      return setInitialGlobals;\n    }() // If initialization gets as far as the story index, this function runs.\n\n  }, {\n    key: \"initializeWithStoryIndex\",\n    value: function initializeWithStoryIndex(storyIndex) {\n      var _this3 = this;\n\n      return _get(_getPrototypeOf(PreviewWeb.prototype), \"initializeWithStoryIndex\", this).call(this, storyIndex).then(function () {\n        var _global$FEATURES;\n\n        if (!((_global$FEATURES = global.FEATURES) !== null && _global$FEATURES !== void 0 && _global$FEATURES.storyStoreV7)) {\n          _this3.channel.emit(Events.SET_STORIES, _this3.storyStore.getSetStoriesPayload());\n        }\n\n        return _this3.selectSpecifiedStory();\n      });\n    } // Use the selection specifier to choose a story, then render it\n\n  }, {\n    key: \"selectSpecifiedStory\",\n    value: function () {\n      var _selectSpecifiedStory = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this$urlStore$select, storySpecifier, viewMode, args, storyId;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.urlStore.selectionSpecifier) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                this.renderMissingStory();\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                _this$urlStore$select = this.urlStore.selectionSpecifier, storySpecifier = _this$urlStore$select.storySpecifier, viewMode = _this$urlStore$select.viewMode, args = _this$urlStore$select.args;\n                storyId = this.storyStore.storyIndex.storyIdFromSpecifier(storySpecifier);\n\n                if (storyId) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                if (storySpecifier === '*') {\n                  this.renderStoryLoadingException(storySpecifier, new Error(dedent(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n            Couldn't find any stories in your Storybook.\\n            - Please check your stories field of your main.js config.\\n            - Also check the browser console and terminal for error messages.\\n          \"])))));\n                } else {\n                  this.renderStoryLoadingException(storySpecifier, new Error(dedent(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n            Couldn't find story matching '\", \"'.\\n            - Are you sure a story with that id exists?\\n            - Please check your stories field of your main.js config.\\n            - Also check the browser console and terminal for error messages.\\n          \"])), storySpecifier)));\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 8:\n                this.urlStore.setSelection({\n                  storyId: storyId,\n                  viewMode: viewMode\n                });\n                this.channel.emit(Events.STORY_SPECIFIED, this.urlStore.selection);\n                this.channel.emit(Events.CURRENT_STORY_WAS_SET, this.urlStore.selection);\n                _context2.next = 13;\n                return this.renderSelection({\n                  persistedArgs: args\n                });\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function selectSpecifiedStory() {\n        return _selectSpecifiedStory.apply(this, arguments);\n      }\n\n      return selectSpecifiedStory;\n    }() // EVENT HANDLERS\n    // This happens when a config file gets reloaded\n\n  }, {\n    key: \"onGetProjectAnnotationsChanged\",\n    value: function () {\n      var _onGetProjectAnnotationsChanged = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref2) {\n        var getProjectAnnotations;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                getProjectAnnotations = _ref2.getProjectAnnotations;\n                _context3.next = 3;\n                return _get(_getPrototypeOf(PreviewWeb.prototype), \"onGetProjectAnnotationsChanged\", this).call(this, {\n                  getProjectAnnotations: getProjectAnnotations\n                });\n\n              case 3:\n                this.renderSelection();\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function onGetProjectAnnotationsChanged(_x) {\n        return _onGetProjectAnnotationsChanged.apply(this, arguments);\n      }\n\n      return onGetProjectAnnotationsChanged;\n    }() // This happens when a glob gets HMR-ed\n\n  }, {\n    key: \"onStoriesChanged\",\n    value: function () {\n      var _onStoriesChanged = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref3) {\n        var _global$FEATURES2;\n\n        var importFn, storyIndex;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                importFn = _ref3.importFn, storyIndex = _ref3.storyIndex;\n\n                _get(_getPrototypeOf(PreviewWeb.prototype), \"onStoriesChanged\", this).call(this, {\n                  importFn: importFn,\n                  storyIndex: storyIndex\n                });\n\n                if ((_global$FEATURES2 = global.FEATURES) !== null && _global$FEATURES2 !== void 0 && _global$FEATURES2.storyStoreV7) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                _context4.t0 = this.channel;\n                _context4.t1 = Events.SET_STORIES;\n                _context4.next = 7;\n                return this.storyStore.getSetStoriesPayload();\n\n              case 7:\n                _context4.t2 = _context4.sent;\n\n                _context4.t0.emit.call(_context4.t0, _context4.t1, _context4.t2);\n\n              case 9:\n                if (!this.urlStore.selection) {\n                  _context4.next = 14;\n                  break;\n                }\n\n                _context4.next = 12;\n                return this.renderSelection();\n\n              case 12:\n                _context4.next = 16;\n                break;\n\n              case 14:\n                _context4.next = 16;\n                return this.selectSpecifiedStory();\n\n              case 16:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function onStoriesChanged(_x2) {\n        return _onStoriesChanged.apply(this, arguments);\n      }\n\n      return onStoriesChanged;\n    }()\n  }, {\n    key: \"onKeydown\",\n    value: function onKeydown(event) {\n      var _this$currentRender;\n\n      if (!((_this$currentRender = this.currentRender) !== null && _this$currentRender !== void 0 && _this$currentRender.disableKeyListeners) && !focusInInput(event)) {\n        // We have to pick off the keys of the event that we need on the other side\n        var altKey = event.altKey,\n            ctrlKey = event.ctrlKey,\n            metaKey = event.metaKey,\n            shiftKey = event.shiftKey,\n            key = event.key,\n            code = event.code,\n            keyCode = event.keyCode;\n        this.channel.emit(Events.PREVIEW_KEYDOWN, {\n          event: {\n            altKey: altKey,\n            ctrlKey: ctrlKey,\n            metaKey: metaKey,\n            shiftKey: shiftKey,\n            key: key,\n            code: code,\n            keyCode: keyCode\n          }\n        });\n      }\n    }\n  }, {\n    key: \"onSetCurrentStory\",\n    value: function onSetCurrentStory(selection) {\n      this.urlStore.setSelection(selection);\n      this.channel.emit(Events.CURRENT_STORY_WAS_SET, this.urlStore.selection);\n      this.renderSelection();\n    }\n  }, {\n    key: \"onUpdateQueryParams\",\n    value: function onUpdateQueryParams(queryParams) {\n      this.urlStore.setQueryParams(queryParams);\n    }\n  }, {\n    key: \"onUpdateGlobals\",\n    value: function () {\n      var _onUpdateGlobals = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_ref4) {\n        var globals;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                globals = _ref4.globals;\n\n                _get(_getPrototypeOf(PreviewWeb.prototype), \"onUpdateGlobals\", this).call(this, {\n                  globals: globals\n                });\n\n                if (!(this.currentRender instanceof DocsRender)) {\n                  _context5.next = 5;\n                  break;\n                }\n\n                _context5.next = 5;\n                return this.currentRender.rerender();\n\n              case 5:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function onUpdateGlobals(_x3) {\n        return _onUpdateGlobals.apply(this, arguments);\n      }\n\n      return onUpdateGlobals;\n    }()\n  }, {\n    key: \"onUpdateArgs\",\n    value: function () {\n      var _onUpdateArgs = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref5) {\n        var storyId, updatedArgs;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                storyId = _ref5.storyId, updatedArgs = _ref5.updatedArgs;\n\n                _get(_getPrototypeOf(PreviewWeb.prototype), \"onUpdateArgs\", this).call(this, {\n                  storyId: storyId,\n                  updatedArgs: updatedArgs\n                }); // NOTE: we aren't checking to see the story args are targetted at the \"right\" story.\n                // This is because we may render >1 story on the page and there is no easy way to keep track\n                // of which ones were rendered by the docs page.\n                // However, in `modernInlineRender`, the individual stories track their own events as they\n                // each call `renderStoryToElement` below.\n\n\n                if (!(this.currentRender instanceof DocsRender)) {\n                  _context6.next = 5;\n                  break;\n                }\n\n                _context6.next = 5;\n                return this.currentRender.rerender();\n\n              case 5:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function onUpdateArgs(_x4) {\n        return _onUpdateArgs.apply(this, arguments);\n      }\n\n      return onUpdateArgs;\n    }()\n  }, {\n    key: \"onPreloadStories\",\n    value: function () {\n      var _onPreloadStories = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(ids) {\n        var _this4 = this;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return Promise.all(ids.map(function (id) {\n                  return _this4.storyStore.loadStory({\n                    storyId: id\n                  });\n                }));\n\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }));\n\n      function onPreloadStories(_x5) {\n        return _onPreloadStories.apply(this, arguments);\n      }\n\n      return onPreloadStories;\n    }() // RENDERING\n    // We can either have:\n    // - a story selected in \"story\" viewMode,\n    //     in which case we render it to the root element, OR\n    // - a story selected in \"docs\" viewMode,\n    //     in which case we render the docsPage for that story\n\n  }, {\n    key: \"renderSelection\",\n    value: function () {\n      var _renderSelection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        var _this$currentSelectio,\n            _this$currentSelectio2,\n            _lastRender,\n            _this5 = this,\n            _global$FEATURES3;\n\n        var _ref6,\n            persistedArgs,\n            selection,\n            storyId,\n            storyIdChanged,\n            viewModeChanged,\n            lastSelection,\n            lastRender,\n            storyRender,\n            implementationChanged,\n            _storyRender$context,\n            parameters,\n            initialArgs,\n            argTypes,\n            args,\n            _args8 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _ref6 = _args8.length > 0 && _args8[0] !== undefined ? _args8[0] : {}, persistedArgs = _ref6.persistedArgs;\n                selection = this.urlStore.selection;\n\n                if (selection) {\n                  _context8.next = 4;\n                  break;\n                }\n\n                throw new Error('Cannot render story as no selection was made');\n\n              case 4:\n                storyId = selection.storyId;\n                storyIdChanged = ((_this$currentSelectio = this.currentSelection) === null || _this$currentSelectio === void 0 ? void 0 : _this$currentSelectio.storyId) !== storyId;\n                viewModeChanged = ((_this$currentSelectio2 = this.currentSelection) === null || _this$currentSelectio2 === void 0 ? void 0 : _this$currentSelectio2.viewMode) !== selection.viewMode; // Show a spinner while we load the next story\n\n                if (selection.viewMode === 'story') {\n                  this.view.showPreparingStory({\n                    immediate: viewModeChanged\n                  });\n                } else {\n                  this.view.showPreparingDocs();\n                }\n\n                lastSelection = this.currentSelection;\n                lastRender = this.currentRender; // If the last render is still preparing, let's drop it right now. Either\n                //   (a) it is a different story, which means we would drop it later, OR\n                //   (b) it is the *same* story, in which case we will resolve our own .prepare() at the\n                //       same moment anyway, and we should just \"take over\" the rendering.\n                // (We can't tell which it is yet, because it is possible that an HMR is going on and\n                //  even though the storyId is the same, the story itself is not).\n\n                if (!((_lastRender = lastRender) !== null && _lastRender !== void 0 && _lastRender.isPreparing())) {\n                  _context8.next = 14;\n                  break;\n                }\n\n                _context8.next = 13;\n                return this.teardownRender(lastRender);\n\n              case 13:\n                lastRender = null;\n\n              case 14:\n                storyRender = new StoryRender(this.channel, this.storyStore, function () {\n                  // At the start of renderToDOM we make the story visible (see note in WebView)\n                  _this5.view.showStoryDuringRender();\n\n                  return _this5.renderToDOM.apply(_this5, arguments);\n                }, this.mainStoryCallbacks(storyId), storyId, 'story'); // We need to store this right away, so if the story changes during\n                // the async `.prepare()` below, we can (potentially) cancel it\n\n                this.currentSelection = selection; // Note this may be replaced by a docsRender after preparing\n\n                this.currentRender = storyRender;\n                _context8.prev = 17;\n                _context8.next = 20;\n                return storyRender.prepare();\n\n              case 20:\n                _context8.next = 29;\n                break;\n\n              case 22:\n                _context8.prev = 22;\n                _context8.t0 = _context8[\"catch\"](17);\n\n                if (!(_context8.t0 !== PREPARE_ABORTED)) {\n                  _context8.next = 28;\n                  break;\n                }\n\n                _context8.next = 27;\n                return this.teardownRender(lastRender);\n\n              case 27:\n                this.renderStoryLoadingException(storyId, _context8.t0);\n\n              case 28:\n                return _context8.abrupt(\"return\");\n\n              case 29:\n                implementationChanged = !storyIdChanged && !storyRender.isEqual(lastRender);\n                if (persistedArgs) this.storyStore.args.updateFromPersisted(storyRender.story, persistedArgs);\n                _storyRender$context = storyRender.context(), parameters = _storyRender$context.parameters, initialArgs = _storyRender$context.initialArgs, argTypes = _storyRender$context.argTypes, args = _storyRender$context.args; // Don't re-render the story if nothing has changed to justify it\n\n                if (!(lastRender && !storyIdChanged && !implementationChanged && !viewModeChanged)) {\n                  _context8.next = 37;\n                  break;\n                }\n\n                this.currentRender = lastRender;\n                this.channel.emit(Events.STORY_UNCHANGED, storyId);\n                this.view.showMain();\n                return _context8.abrupt(\"return\");\n\n              case 37:\n                _context8.next = 39;\n                return this.teardownRender(lastRender, {\n                  viewModeChanged: viewModeChanged\n                });\n\n              case 39:\n                // If we are rendering something new (as opposed to re-rendering the same or first story), emit\n                if (lastSelection && (storyIdChanged || viewModeChanged)) {\n                  this.channel.emit(Events.STORY_CHANGED, storyId);\n                }\n\n                if ((_global$FEATURES3 = global.FEATURES) !== null && _global$FEATURES3 !== void 0 && _global$FEATURES3.storyStoreV7) {\n                  this.channel.emit(Events.STORY_PREPARED, {\n                    id: storyId,\n                    parameters: parameters,\n                    initialArgs: initialArgs,\n                    argTypes: argTypes,\n                    args: args\n                  });\n                } // For v6 mode / compatibility\n                // If the implementation changed, or args were persisted, the args may have changed,\n                // and the STORY_PREPARED event above may not be respected.\n\n\n                if (implementationChanged || persistedArgs) {\n                  this.channel.emit(Events.STORY_ARGS_UPDATED, {\n                    storyId: storyId,\n                    args: args\n                  });\n                }\n\n                if (selection.viewMode === 'docs' || parameters.docsOnly) {\n                  this.currentRender = DocsRender.fromStoryRender(storyRender);\n                  this.currentRender.renderToElement(this.view.prepareForDocs(), this.renderStoryToElement.bind(this));\n                } else {\n                  this.storyRenders.push(storyRender);\n                  this.currentRender.renderToElement(this.view.prepareForStory(storyRender.story));\n                }\n\n              case 43:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[17, 22]]);\n      }));\n\n      function renderSelection() {\n        return _renderSelection.apply(this, arguments);\n      }\n\n      return renderSelection;\n    }() // Used by docs' modernInlineRender to render a story to a given element\n    // Note this short-circuits the `prepare()` phase of the StoryRender,\n    // main to be consistent with the previous behaviour. In the future,\n    // we will change it to go ahead and load the story, which will end up being\n    // \"instant\", although async.\n\n  }, {\n    key: \"renderStoryToElement\",\n    value: function renderStoryToElement(story, element) {\n      var _this6 = this;\n\n      var render = new StoryRender(this.channel, this.storyStore, this.renderToDOM, this.inlineStoryCallbacks(story.id), story.id, 'docs', story);\n      render.renderToElement(element);\n      this.storyRenders.push(render);\n      return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return _this6.teardownRender(render);\n\n              case 2:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n    }\n  }, {\n    key: \"teardownRender\",\n    value: function () {\n      var _teardownRender = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(render) {\n        var _ref8,\n            viewModeChanged,\n            _args10 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _ref8 = _args10.length > 1 && _args10[1] !== undefined ? _args10[1] : {}, viewModeChanged = _ref8.viewModeChanged;\n                this.storyRenders = this.storyRenders.filter(function (r) {\n                  return r !== render;\n                });\n                _context10.next = 4;\n                return render === null || render === void 0 ? void 0 : render.teardown({\n                  viewModeChanged: viewModeChanged\n                });\n\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function teardownRender(_x6) {\n        return _teardownRender.apply(this, arguments);\n      }\n\n      return teardownRender;\n    }() // API\n\n  }, {\n    key: \"extract\",\n    value: function () {\n      var _extract = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(options) {\n        var _global$FEATURES4;\n\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                if (!this.previewEntryError) {\n                  _context11.next = 2;\n                  break;\n                }\n\n                throw this.previewEntryError;\n\n              case 2:\n                if (this.storyStore.projectAnnotations) {\n                  _context11.next = 4;\n                  break;\n                }\n\n                throw new Error(dedent(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"Failed to initialize Storybook.\\n      \\n      Do you have an error in your `preview.js`? Check your Storybook's browser console for errors.\"], [\"Failed to initialize Storybook.\\n      \\n      Do you have an error in your \\\\`preview.js\\\\`? Check your Storybook's browser console for errors.\"]))));\n\n              case 4:\n                if (!((_global$FEATURES4 = global.FEATURES) !== null && _global$FEATURES4 !== void 0 && _global$FEATURES4.storyStoreV7)) {\n                  _context11.next = 7;\n                  break;\n                }\n\n                _context11.next = 7;\n                return this.storyStore.cacheAllCSFFiles();\n\n              case 7:\n                return _context11.abrupt(\"return\", this.storyStore.extract(options));\n\n              case 8:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function extract(_x7) {\n        return _extract.apply(this, arguments);\n      }\n\n      return extract;\n    }() // UTILITIES\n\n  }, {\n    key: \"mainStoryCallbacks\",\n    value: function mainStoryCallbacks(storyId) {\n      var _this7 = this;\n\n      return {\n        showMain: function showMain() {\n          return _this7.view.showMain();\n        },\n        showError: function showError(err) {\n          return _this7.renderError(storyId, err);\n        },\n        showException: function showException(err) {\n          return _this7.renderException(storyId, err);\n        }\n      };\n    }\n  }, {\n    key: \"inlineStoryCallbacks\",\n    value: function inlineStoryCallbacks(storyId) {\n      return {\n        showMain: function showMain() {},\n        showError: function showError(err) {\n          return logger.error(\"Error rendering docs story (\".concat(storyId, \")\"), err);\n        },\n        showException: function showException(err) {\n          return logger.error(\"Error rendering docs story (\".concat(storyId, \")\"), err);\n        }\n      };\n    }\n  }, {\n    key: \"renderPreviewEntryError\",\n    value: function renderPreviewEntryError(reason, err) {\n      _get(_getPrototypeOf(PreviewWeb.prototype), \"renderPreviewEntryError\", this).call(this, reason, err);\n\n      this.view.showErrorDisplay(err);\n    }\n  }, {\n    key: \"renderMissingStory\",\n    value: function renderMissingStory() {\n      this.view.showNoPreview();\n      this.channel.emit(Events.STORY_MISSING);\n    }\n  }, {\n    key: \"renderStoryLoadingException\",\n    value: function renderStoryLoadingException(storySpecifier, err) {\n      logger.error(\"Unable to load story '\".concat(storySpecifier, \"':\"));\n      logger.error(err);\n      this.view.showErrorDisplay(err);\n      this.channel.emit(Events.STORY_MISSING, storySpecifier);\n    } // renderException is used if we fail to render the story and it is uncaught by the app layer\n\n  }, {\n    key: \"renderException\",\n    value: function renderException(storyId, err) {\n      this.channel.emit(Events.STORY_THREW_EXCEPTION, err);\n      this.channel.emit(Events.STORY_RENDER_PHASE_CHANGED, {\n        newPhase: 'errored',\n        storyId: storyId\n      }); // Ignored exceptions exist for control flow purposes, and are typically handled elsewhere.\n\n      if (err !== IGNORED_EXCEPTION) {\n        this.view.showErrorDisplay(err);\n        logger.error(\"Error rendering story '\".concat(storyId, \"':\"));\n        logger.error(err);\n      }\n    } // renderError is used by the various app layers to inform the user they have done something\n    // wrong -- for instance returned the wrong thing from a story\n\n  }, {\n    key: \"renderError\",\n    value: function renderError(storyId, _ref9) {\n      var title = _ref9.title,\n          description = _ref9.description;\n      logger.error(\"Error rendering story \".concat(title, \": \").concat(description));\n      this.channel.emit(Events.STORY_ERRORED, {\n        title: title,\n        description: description\n      });\n      this.channel.emit(Events.STORY_RENDER_PHASE_CHANGED, {\n        newPhase: 'errored',\n        storyId: storyId\n      });\n      this.view.showErrorDisplay({\n        message: title,\n        stack: description\n      });\n    }\n  }]);\n\n  return PreviewWeb;\n}(Preview);","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_templateObject","_templateObject2","_templateObject3","_templateObject4","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","defineProperty","_createClass","protoProps","staticProps","_get","Reflect","get","property","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","call","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","deprecate","dedent","global","Events","IGNORED_EXCEPTION","logger","Preview","UrlStore","WebView","PREPARE_ABORTED","StoryRender","DocsRender","globalWindow","window","focusInInput","event","test","tagName","getAttribute","PreviewWeb","_Preview","_super","_this","urlStore","view","previewEntryError","currentSelection","currentRender","storyStore","getSelection","selection","setupListeners","onkeydown","onKeydown","bind","channel","on","SET_CURRENT_STORY","onSetCurrentStory","UPDATE_QUERY_PARAMS","onUpdateQueryParams","PRELOAD_STORIES","onPreloadStories","initializeWithProjectAnnotations","projectAnnotations","_this2","setInitialGlobals","_setInitialGlobals","mark","_callee","_ref","globals","wrap","_callee$","_context","prev","next","selectionSpecifier","updateFromPersisted","emitGlobals","stop","initializeWithStoryIndex","storyIndex","_this3","_global$FEATURES","FEATURES","storyStoreV7","emit","SET_STORIES","getSetStoriesPayload","selectSpecifiedStory","_selectSpecifiedStory","_callee2","_this$urlStore$select","storySpecifier","viewMode","storyId","_callee2$","_context2","renderMissingStory","abrupt","storyIdFromSpecifier","renderStoryLoadingException","Error","setSelection","STORY_SPECIFIED","CURRENT_STORY_WAS_SET","renderSelection","persistedArgs","_onGetProjectAnnotationsChanged","_callee3","_ref2","getProjectAnnotations","_callee3$","_context3","onGetProjectAnnotationsChanged","_x","_onStoriesChanged","_callee4","_ref3","_global$FEATURES2","importFn","_callee4$","_context4","t0","t1","t2","sent","onStoriesChanged","_x2","_this$currentRender","disableKeyListeners","altKey","ctrlKey","metaKey","shiftKey","code","keyCode","PREVIEW_KEYDOWN","queryParams","setQueryParams","_onUpdateGlobals","_callee5","_ref4","_callee5$","_context5","rerender","onUpdateGlobals","_x3","_onUpdateArgs","_callee6","_ref5","updatedArgs","_callee6$","_context6","onUpdateArgs","_x4","_onPreloadStories","_callee7","ids","_this4","_callee7$","_context7","all","map","id","loadStory","_x5","_renderSelection","_callee8","_this$currentSelectio","_this$currentSelectio2","_lastRender","_this5","_global$FEATURES3","_ref6","storyIdChanged","viewModeChanged","lastSelection","lastRender","storyRender","implementationChanged","_storyRender$context","parameters","initialArgs","argTypes","_args8","_callee8$","_context8","showPreparingStory","immediate","showPreparingDocs","isPreparing","teardownRender","showStoryDuringRender","renderToDOM","mainStoryCallbacks","prepare","isEqual","story","context","STORY_UNCHANGED","showMain","STORY_CHANGED","STORY_PREPARED","STORY_ARGS_UPDATED","docsOnly","fromStoryRender","renderToElement","prepareForDocs","renderStoryToElement","storyRenders","push","prepareForStory","element","_this6","render","inlineStoryCallbacks","_callee9","_callee9$","_context9","_teardownRender","_callee10","_ref8","_args10","_callee10$","_context10","filter","r","teardown","_x6","_extract","_callee11","options","_global$FEATURES4","_callee11$","_context11","cacheAllCSFFiles","extract","_x7","_this7","showError","renderError","showException","renderException","concat","renderPreviewEntryError","reason","showErrorDisplay","showNoPreview","STORY_MISSING","STORY_THREW_EXCEPTION","STORY_RENDER_PHASE_CHANGED","newPhase","_ref9","title","description","STORY_ERRORED","message","stack"],"sources":["/Users/raulmelo/Documents/projetos/design-system/storybook-wyz/node_modules/@storybook/preview-web/dist/esm/PreviewWeb.js"],"sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nimport \"core-js/modules/es.object.get-prototype-of.js\";\nimport \"core-js/modules/es.reflect.construct.js\";\nimport \"core-js/modules/es.reflect.get.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.object.freeze.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4;\n\nimport \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport deprecate from 'util-deprecate';\nimport dedent from 'ts-dedent';\nimport global from 'global';\nimport Events, { IGNORED_EXCEPTION } from '@storybook/core-events';\nimport { logger } from '@storybook/client-logger';\nimport { Preview } from './Preview';\nimport { UrlStore } from './UrlStore';\nimport { WebView } from './WebView';\nimport { PREPARE_ABORTED, StoryRender } from './StoryRender';\nimport { DocsRender } from './DocsRender';\nvar globalWindow = global.window;\n\nfunction focusInInput(event) {\n  var target = event.target;\n  return /input|textarea/i.test(target.tagName) || target.getAttribute('contenteditable') !== null;\n}\n\nexport var PreviewWeb = /*#__PURE__*/function (_Preview) {\n  _inherits(PreviewWeb, _Preview);\n\n  var _super = _createSuper(PreviewWeb);\n\n  function PreviewWeb() {\n    var _this;\n\n    _classCallCheck(this, PreviewWeb);\n\n    _this = _super.call(this);\n    _this.urlStore = void 0;\n    _this.view = void 0;\n    _this.previewEntryError = void 0;\n    _this.currentSelection = void 0;\n    _this.currentRender = void 0;\n    _this.view = new WebView();\n    _this.urlStore = new UrlStore(); // Add deprecated APIs for back-compat\n    // @ts-ignore\n\n    _this.storyStore.getSelection = deprecate(function () {\n      return _this.urlStore.selection;\n    }, dedent(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n        `__STORYBOOK_STORY_STORE__.getSelection()` is deprecated and will be removed in 7.0.\\n  \\n        To get the current selection, use the `useStoryContext()` hook from `@storybook/addons`.\\n      \"], [\"\\n        \\\\`__STORYBOOK_STORY_STORE__.getSelection()\\\\` is deprecated and will be removed in 7.0.\\n  \\n        To get the current selection, use the \\\\`useStoryContext()\\\\` hook from \\\\`@storybook/addons\\\\`.\\n      \"]))));\n    return _this;\n  }\n\n  _createClass(PreviewWeb, [{\n    key: \"setupListeners\",\n    value: function setupListeners() {\n      _get(_getPrototypeOf(PreviewWeb.prototype), \"setupListeners\", this).call(this);\n\n      globalWindow.onkeydown = this.onKeydown.bind(this);\n      this.channel.on(Events.SET_CURRENT_STORY, this.onSetCurrentStory.bind(this));\n      this.channel.on(Events.UPDATE_QUERY_PARAMS, this.onUpdateQueryParams.bind(this));\n      this.channel.on(Events.PRELOAD_STORIES, this.onPreloadStories.bind(this));\n    }\n  }, {\n    key: \"initializeWithProjectAnnotations\",\n    value: function initializeWithProjectAnnotations(projectAnnotations) {\n      var _this2 = this;\n\n      return _get(_getPrototypeOf(PreviewWeb.prototype), \"initializeWithProjectAnnotations\", this).call(this, projectAnnotations).then(function () {\n        return _this2.setInitialGlobals();\n      });\n    }\n  }, {\n    key: \"setInitialGlobals\",\n    value: function () {\n      var _setInitialGlobals = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _ref, globals;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _ref = this.urlStore.selectionSpecifier || {}, globals = _ref.globals;\n\n                if (globals) {\n                  this.storyStore.globals.updateFromPersisted(globals);\n                }\n\n                this.emitGlobals();\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setInitialGlobals() {\n        return _setInitialGlobals.apply(this, arguments);\n      }\n\n      return setInitialGlobals;\n    }() // If initialization gets as far as the story index, this function runs.\n\n  }, {\n    key: \"initializeWithStoryIndex\",\n    value: function initializeWithStoryIndex(storyIndex) {\n      var _this3 = this;\n\n      return _get(_getPrototypeOf(PreviewWeb.prototype), \"initializeWithStoryIndex\", this).call(this, storyIndex).then(function () {\n        var _global$FEATURES;\n\n        if (!((_global$FEATURES = global.FEATURES) !== null && _global$FEATURES !== void 0 && _global$FEATURES.storyStoreV7)) {\n          _this3.channel.emit(Events.SET_STORIES, _this3.storyStore.getSetStoriesPayload());\n        }\n\n        return _this3.selectSpecifiedStory();\n      });\n    } // Use the selection specifier to choose a story, then render it\n\n  }, {\n    key: \"selectSpecifiedStory\",\n    value: function () {\n      var _selectSpecifiedStory = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _this$urlStore$select, storySpecifier, viewMode, args, storyId;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.urlStore.selectionSpecifier) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                this.renderMissingStory();\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                _this$urlStore$select = this.urlStore.selectionSpecifier, storySpecifier = _this$urlStore$select.storySpecifier, viewMode = _this$urlStore$select.viewMode, args = _this$urlStore$select.args;\n                storyId = this.storyStore.storyIndex.storyIdFromSpecifier(storySpecifier);\n\n                if (storyId) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                if (storySpecifier === '*') {\n                  this.renderStoryLoadingException(storySpecifier, new Error(dedent(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n            Couldn't find any stories in your Storybook.\\n            - Please check your stories field of your main.js config.\\n            - Also check the browser console and terminal for error messages.\\n          \"])))));\n                } else {\n                  this.renderStoryLoadingException(storySpecifier, new Error(dedent(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n            Couldn't find story matching '\", \"'.\\n            - Are you sure a story with that id exists?\\n            - Please check your stories field of your main.js config.\\n            - Also check the browser console and terminal for error messages.\\n          \"])), storySpecifier)));\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 8:\n                this.urlStore.setSelection({\n                  storyId: storyId,\n                  viewMode: viewMode\n                });\n                this.channel.emit(Events.STORY_SPECIFIED, this.urlStore.selection);\n                this.channel.emit(Events.CURRENT_STORY_WAS_SET, this.urlStore.selection);\n                _context2.next = 13;\n                return this.renderSelection({\n                  persistedArgs: args\n                });\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function selectSpecifiedStory() {\n        return _selectSpecifiedStory.apply(this, arguments);\n      }\n\n      return selectSpecifiedStory;\n    }() // EVENT HANDLERS\n    // This happens when a config file gets reloaded\n\n  }, {\n    key: \"onGetProjectAnnotationsChanged\",\n    value: function () {\n      var _onGetProjectAnnotationsChanged = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(_ref2) {\n        var getProjectAnnotations;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                getProjectAnnotations = _ref2.getProjectAnnotations;\n                _context3.next = 3;\n                return _get(_getPrototypeOf(PreviewWeb.prototype), \"onGetProjectAnnotationsChanged\", this).call(this, {\n                  getProjectAnnotations: getProjectAnnotations\n                });\n\n              case 3:\n                this.renderSelection();\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function onGetProjectAnnotationsChanged(_x) {\n        return _onGetProjectAnnotationsChanged.apply(this, arguments);\n      }\n\n      return onGetProjectAnnotationsChanged;\n    }() // This happens when a glob gets HMR-ed\n\n  }, {\n    key: \"onStoriesChanged\",\n    value: function () {\n      var _onStoriesChanged = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(_ref3) {\n        var _global$FEATURES2;\n\n        var importFn, storyIndex;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                importFn = _ref3.importFn, storyIndex = _ref3.storyIndex;\n\n                _get(_getPrototypeOf(PreviewWeb.prototype), \"onStoriesChanged\", this).call(this, {\n                  importFn: importFn,\n                  storyIndex: storyIndex\n                });\n\n                if ((_global$FEATURES2 = global.FEATURES) !== null && _global$FEATURES2 !== void 0 && _global$FEATURES2.storyStoreV7) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                _context4.t0 = this.channel;\n                _context4.t1 = Events.SET_STORIES;\n                _context4.next = 7;\n                return this.storyStore.getSetStoriesPayload();\n\n              case 7:\n                _context4.t2 = _context4.sent;\n\n                _context4.t0.emit.call(_context4.t0, _context4.t1, _context4.t2);\n\n              case 9:\n                if (!this.urlStore.selection) {\n                  _context4.next = 14;\n                  break;\n                }\n\n                _context4.next = 12;\n                return this.renderSelection();\n\n              case 12:\n                _context4.next = 16;\n                break;\n\n              case 14:\n                _context4.next = 16;\n                return this.selectSpecifiedStory();\n\n              case 16:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function onStoriesChanged(_x2) {\n        return _onStoriesChanged.apply(this, arguments);\n      }\n\n      return onStoriesChanged;\n    }()\n  }, {\n    key: \"onKeydown\",\n    value: function onKeydown(event) {\n      var _this$currentRender;\n\n      if (!((_this$currentRender = this.currentRender) !== null && _this$currentRender !== void 0 && _this$currentRender.disableKeyListeners) && !focusInInput(event)) {\n        // We have to pick off the keys of the event that we need on the other side\n        var altKey = event.altKey,\n            ctrlKey = event.ctrlKey,\n            metaKey = event.metaKey,\n            shiftKey = event.shiftKey,\n            key = event.key,\n            code = event.code,\n            keyCode = event.keyCode;\n        this.channel.emit(Events.PREVIEW_KEYDOWN, {\n          event: {\n            altKey: altKey,\n            ctrlKey: ctrlKey,\n            metaKey: metaKey,\n            shiftKey: shiftKey,\n            key: key,\n            code: code,\n            keyCode: keyCode\n          }\n        });\n      }\n    }\n  }, {\n    key: \"onSetCurrentStory\",\n    value: function onSetCurrentStory(selection) {\n      this.urlStore.setSelection(selection);\n      this.channel.emit(Events.CURRENT_STORY_WAS_SET, this.urlStore.selection);\n      this.renderSelection();\n    }\n  }, {\n    key: \"onUpdateQueryParams\",\n    value: function onUpdateQueryParams(queryParams) {\n      this.urlStore.setQueryParams(queryParams);\n    }\n  }, {\n    key: \"onUpdateGlobals\",\n    value: function () {\n      var _onUpdateGlobals = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(_ref4) {\n        var globals;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                globals = _ref4.globals;\n\n                _get(_getPrototypeOf(PreviewWeb.prototype), \"onUpdateGlobals\", this).call(this, {\n                  globals: globals\n                });\n\n                if (!(this.currentRender instanceof DocsRender)) {\n                  _context5.next = 5;\n                  break;\n                }\n\n                _context5.next = 5;\n                return this.currentRender.rerender();\n\n              case 5:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function onUpdateGlobals(_x3) {\n        return _onUpdateGlobals.apply(this, arguments);\n      }\n\n      return onUpdateGlobals;\n    }()\n  }, {\n    key: \"onUpdateArgs\",\n    value: function () {\n      var _onUpdateArgs = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6(_ref5) {\n        var storyId, updatedArgs;\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                storyId = _ref5.storyId, updatedArgs = _ref5.updatedArgs;\n\n                _get(_getPrototypeOf(PreviewWeb.prototype), \"onUpdateArgs\", this).call(this, {\n                  storyId: storyId,\n                  updatedArgs: updatedArgs\n                }); // NOTE: we aren't checking to see the story args are targetted at the \"right\" story.\n                // This is because we may render >1 story on the page and there is no easy way to keep track\n                // of which ones were rendered by the docs page.\n                // However, in `modernInlineRender`, the individual stories track their own events as they\n                // each call `renderStoryToElement` below.\n\n\n                if (!(this.currentRender instanceof DocsRender)) {\n                  _context6.next = 5;\n                  break;\n                }\n\n                _context6.next = 5;\n                return this.currentRender.rerender();\n\n              case 5:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function onUpdateArgs(_x4) {\n        return _onUpdateArgs.apply(this, arguments);\n      }\n\n      return onUpdateArgs;\n    }()\n  }, {\n    key: \"onPreloadStories\",\n    value: function () {\n      var _onPreloadStories = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7(ids) {\n        var _this4 = this;\n\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return Promise.all(ids.map(function (id) {\n                  return _this4.storyStore.loadStory({\n                    storyId: id\n                  });\n                }));\n\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }));\n\n      function onPreloadStories(_x5) {\n        return _onPreloadStories.apply(this, arguments);\n      }\n\n      return onPreloadStories;\n    }() // RENDERING\n    // We can either have:\n    // - a story selected in \"story\" viewMode,\n    //     in which case we render it to the root element, OR\n    // - a story selected in \"docs\" viewMode,\n    //     in which case we render the docsPage for that story\n\n  }, {\n    key: \"renderSelection\",\n    value: function () {\n      var _renderSelection = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {\n        var _this$currentSelectio,\n            _this$currentSelectio2,\n            _lastRender,\n            _this5 = this,\n            _global$FEATURES3;\n\n        var _ref6,\n            persistedArgs,\n            selection,\n            storyId,\n            storyIdChanged,\n            viewModeChanged,\n            lastSelection,\n            lastRender,\n            storyRender,\n            implementationChanged,\n            _storyRender$context,\n            parameters,\n            initialArgs,\n            argTypes,\n            args,\n            _args8 = arguments;\n\n        return regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _ref6 = _args8.length > 0 && _args8[0] !== undefined ? _args8[0] : {}, persistedArgs = _ref6.persistedArgs;\n                selection = this.urlStore.selection;\n\n                if (selection) {\n                  _context8.next = 4;\n                  break;\n                }\n\n                throw new Error('Cannot render story as no selection was made');\n\n              case 4:\n                storyId = selection.storyId;\n                storyIdChanged = ((_this$currentSelectio = this.currentSelection) === null || _this$currentSelectio === void 0 ? void 0 : _this$currentSelectio.storyId) !== storyId;\n                viewModeChanged = ((_this$currentSelectio2 = this.currentSelection) === null || _this$currentSelectio2 === void 0 ? void 0 : _this$currentSelectio2.viewMode) !== selection.viewMode; // Show a spinner while we load the next story\n\n                if (selection.viewMode === 'story') {\n                  this.view.showPreparingStory({\n                    immediate: viewModeChanged\n                  });\n                } else {\n                  this.view.showPreparingDocs();\n                }\n\n                lastSelection = this.currentSelection;\n                lastRender = this.currentRender; // If the last render is still preparing, let's drop it right now. Either\n                //   (a) it is a different story, which means we would drop it later, OR\n                //   (b) it is the *same* story, in which case we will resolve our own .prepare() at the\n                //       same moment anyway, and we should just \"take over\" the rendering.\n                // (We can't tell which it is yet, because it is possible that an HMR is going on and\n                //  even though the storyId is the same, the story itself is not).\n\n                if (!((_lastRender = lastRender) !== null && _lastRender !== void 0 && _lastRender.isPreparing())) {\n                  _context8.next = 14;\n                  break;\n                }\n\n                _context8.next = 13;\n                return this.teardownRender(lastRender);\n\n              case 13:\n                lastRender = null;\n\n              case 14:\n                storyRender = new StoryRender(this.channel, this.storyStore, function () {\n                  // At the start of renderToDOM we make the story visible (see note in WebView)\n                  _this5.view.showStoryDuringRender();\n\n                  return _this5.renderToDOM.apply(_this5, arguments);\n                }, this.mainStoryCallbacks(storyId), storyId, 'story'); // We need to store this right away, so if the story changes during\n                // the async `.prepare()` below, we can (potentially) cancel it\n\n                this.currentSelection = selection; // Note this may be replaced by a docsRender after preparing\n\n                this.currentRender = storyRender;\n                _context8.prev = 17;\n                _context8.next = 20;\n                return storyRender.prepare();\n\n              case 20:\n                _context8.next = 29;\n                break;\n\n              case 22:\n                _context8.prev = 22;\n                _context8.t0 = _context8[\"catch\"](17);\n\n                if (!(_context8.t0 !== PREPARE_ABORTED)) {\n                  _context8.next = 28;\n                  break;\n                }\n\n                _context8.next = 27;\n                return this.teardownRender(lastRender);\n\n              case 27:\n                this.renderStoryLoadingException(storyId, _context8.t0);\n\n              case 28:\n                return _context8.abrupt(\"return\");\n\n              case 29:\n                implementationChanged = !storyIdChanged && !storyRender.isEqual(lastRender);\n                if (persistedArgs) this.storyStore.args.updateFromPersisted(storyRender.story, persistedArgs);\n                _storyRender$context = storyRender.context(), parameters = _storyRender$context.parameters, initialArgs = _storyRender$context.initialArgs, argTypes = _storyRender$context.argTypes, args = _storyRender$context.args; // Don't re-render the story if nothing has changed to justify it\n\n                if (!(lastRender && !storyIdChanged && !implementationChanged && !viewModeChanged)) {\n                  _context8.next = 37;\n                  break;\n                }\n\n                this.currentRender = lastRender;\n                this.channel.emit(Events.STORY_UNCHANGED, storyId);\n                this.view.showMain();\n                return _context8.abrupt(\"return\");\n\n              case 37:\n                _context8.next = 39;\n                return this.teardownRender(lastRender, {\n                  viewModeChanged: viewModeChanged\n                });\n\n              case 39:\n                // If we are rendering something new (as opposed to re-rendering the same or first story), emit\n                if (lastSelection && (storyIdChanged || viewModeChanged)) {\n                  this.channel.emit(Events.STORY_CHANGED, storyId);\n                }\n\n                if ((_global$FEATURES3 = global.FEATURES) !== null && _global$FEATURES3 !== void 0 && _global$FEATURES3.storyStoreV7) {\n                  this.channel.emit(Events.STORY_PREPARED, {\n                    id: storyId,\n                    parameters: parameters,\n                    initialArgs: initialArgs,\n                    argTypes: argTypes,\n                    args: args\n                  });\n                } // For v6 mode / compatibility\n                // If the implementation changed, or args were persisted, the args may have changed,\n                // and the STORY_PREPARED event above may not be respected.\n\n\n                if (implementationChanged || persistedArgs) {\n                  this.channel.emit(Events.STORY_ARGS_UPDATED, {\n                    storyId: storyId,\n                    args: args\n                  });\n                }\n\n                if (selection.viewMode === 'docs' || parameters.docsOnly) {\n                  this.currentRender = DocsRender.fromStoryRender(storyRender);\n                  this.currentRender.renderToElement(this.view.prepareForDocs(), this.renderStoryToElement.bind(this));\n                } else {\n                  this.storyRenders.push(storyRender);\n                  this.currentRender.renderToElement(this.view.prepareForStory(storyRender.story));\n                }\n\n              case 43:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[17, 22]]);\n      }));\n\n      function renderSelection() {\n        return _renderSelection.apply(this, arguments);\n      }\n\n      return renderSelection;\n    }() // Used by docs' modernInlineRender to render a story to a given element\n    // Note this short-circuits the `prepare()` phase of the StoryRender,\n    // main to be consistent with the previous behaviour. In the future,\n    // we will change it to go ahead and load the story, which will end up being\n    // \"instant\", although async.\n\n  }, {\n    key: \"renderStoryToElement\",\n    value: function renderStoryToElement(story, element) {\n      var _this6 = this;\n\n      var render = new StoryRender(this.channel, this.storyStore, this.renderToDOM, this.inlineStoryCallbacks(story.id), story.id, 'docs', story);\n      render.renderToElement(element);\n      this.storyRenders.push(render);\n      return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee9() {\n        return regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return _this6.teardownRender(render);\n\n              case 2:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n    }\n  }, {\n    key: \"teardownRender\",\n    value: function () {\n      var _teardownRender = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee10(render) {\n        var _ref8,\n            viewModeChanged,\n            _args10 = arguments;\n\n        return regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _ref8 = _args10.length > 1 && _args10[1] !== undefined ? _args10[1] : {}, viewModeChanged = _ref8.viewModeChanged;\n                this.storyRenders = this.storyRenders.filter(function (r) {\n                  return r !== render;\n                });\n                _context10.next = 4;\n                return render === null || render === void 0 ? void 0 : render.teardown({\n                  viewModeChanged: viewModeChanged\n                });\n\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function teardownRender(_x6) {\n        return _teardownRender.apply(this, arguments);\n      }\n\n      return teardownRender;\n    }() // API\n\n  }, {\n    key: \"extract\",\n    value: function () {\n      var _extract = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee11(options) {\n        var _global$FEATURES4;\n\n        return regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                if (!this.previewEntryError) {\n                  _context11.next = 2;\n                  break;\n                }\n\n                throw this.previewEntryError;\n\n              case 2:\n                if (this.storyStore.projectAnnotations) {\n                  _context11.next = 4;\n                  break;\n                }\n\n                throw new Error(dedent(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"Failed to initialize Storybook.\\n      \\n      Do you have an error in your `preview.js`? Check your Storybook's browser console for errors.\"], [\"Failed to initialize Storybook.\\n      \\n      Do you have an error in your \\\\`preview.js\\\\`? Check your Storybook's browser console for errors.\"]))));\n\n              case 4:\n                if (!((_global$FEATURES4 = global.FEATURES) !== null && _global$FEATURES4 !== void 0 && _global$FEATURES4.storyStoreV7)) {\n                  _context11.next = 7;\n                  break;\n                }\n\n                _context11.next = 7;\n                return this.storyStore.cacheAllCSFFiles();\n\n              case 7:\n                return _context11.abrupt(\"return\", this.storyStore.extract(options));\n\n              case 8:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function extract(_x7) {\n        return _extract.apply(this, arguments);\n      }\n\n      return extract;\n    }() // UTILITIES\n\n  }, {\n    key: \"mainStoryCallbacks\",\n    value: function mainStoryCallbacks(storyId) {\n      var _this7 = this;\n\n      return {\n        showMain: function showMain() {\n          return _this7.view.showMain();\n        },\n        showError: function showError(err) {\n          return _this7.renderError(storyId, err);\n        },\n        showException: function showException(err) {\n          return _this7.renderException(storyId, err);\n        }\n      };\n    }\n  }, {\n    key: \"inlineStoryCallbacks\",\n    value: function inlineStoryCallbacks(storyId) {\n      return {\n        showMain: function showMain() {},\n        showError: function showError(err) {\n          return logger.error(\"Error rendering docs story (\".concat(storyId, \")\"), err);\n        },\n        showException: function showException(err) {\n          return logger.error(\"Error rendering docs story (\".concat(storyId, \")\"), err);\n        }\n      };\n    }\n  }, {\n    key: \"renderPreviewEntryError\",\n    value: function renderPreviewEntryError(reason, err) {\n      _get(_getPrototypeOf(PreviewWeb.prototype), \"renderPreviewEntryError\", this).call(this, reason, err);\n\n      this.view.showErrorDisplay(err);\n    }\n  }, {\n    key: \"renderMissingStory\",\n    value: function renderMissingStory() {\n      this.view.showNoPreview();\n      this.channel.emit(Events.STORY_MISSING);\n    }\n  }, {\n    key: \"renderStoryLoadingException\",\n    value: function renderStoryLoadingException(storySpecifier, err) {\n      logger.error(\"Unable to load story '\".concat(storySpecifier, \"':\"));\n      logger.error(err);\n      this.view.showErrorDisplay(err);\n      this.channel.emit(Events.STORY_MISSING, storySpecifier);\n    } // renderException is used if we fail to render the story and it is uncaught by the app layer\n\n  }, {\n    key: \"renderException\",\n    value: function renderException(storyId, err) {\n      this.channel.emit(Events.STORY_THREW_EXCEPTION, err);\n      this.channel.emit(Events.STORY_RENDER_PHASE_CHANGED, {\n        newPhase: 'errored',\n        storyId: storyId\n      }); // Ignored exceptions exist for control flow purposes, and are typically handled elsewhere.\n\n      if (err !== IGNORED_EXCEPTION) {\n        this.view.showErrorDisplay(err);\n        logger.error(\"Error rendering story '\".concat(storyId, \"':\"));\n        logger.error(err);\n      }\n    } // renderError is used by the various app layers to inform the user they have done something\n    // wrong -- for instance returned the wrong thing from a story\n\n  }, {\n    key: \"renderError\",\n    value: function renderError(storyId, _ref9) {\n      var title = _ref9.title,\n          description = _ref9.description;\n      logger.error(\"Error rendering story \".concat(title, \": \").concat(description));\n      this.channel.emit(Events.STORY_ERRORED, {\n        title: title,\n        description: description\n      });\n      this.channel.emit(Events.STORY_RENDER_PHASE_CHANGED, {\n        newPhase: 'errored',\n        storyId: storyId\n      });\n      this.view.showErrorDisplay({\n        message: title,\n        stack: description\n      });\n    }\n  }]);\n\n  return PreviewWeb;\n}(Preview);"],"mappings":"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"},"metadata":{},"sourceType":"module"}